<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Seguimiento de Pedido</title>
<link href="https://fonts.googleapis.com/css2?family=Sawarabi+Mincho&family=Montserrat&display=swap" rel="stylesheet" />
<style>
    body {
        font-family: 'Montserrat', sans-serif;
        background: linear-gradient(to bottom right, #fb7070, #70b4fb);
        margin: 0;
        padding: 0;
        color: #222;
    }

    h1 {
        font-family: 'Sawarabi Mincho', serif;
        text-align: center;
        font-size: 2rem;
        color: #d91e18;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        margin-top: 20px;
    }

    .pedido-info {
        text-align: center;
        margin-bottom: 20px;
    }

    .codigo-pedido {
        font-size: 1.2rem;
        color: #000;
        font-weight: bold;
    }

    .rastreo-form {
        max-width: 400px;
        margin: 20px auto;
        background: rgba(255,255,255,0.85);
        padding: 15px;
        border-radius: 15px;
    }

    .rastreo-form label {
        display: block;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .rastreo-form input {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
    }

    .rastreo-form button {
        width: 100%;
        padding: 10px;
        border-radius: 25px;
        border: none;
        background: linear-gradient(45deg, #d91e18, #7ec8e3);
        color: white;
        font-weight: bold;
        cursor: pointer;
    }

    .timeline-container {
        background: rgba(255,255,255,0.85);
        border-radius: 20px;
        padding: 20px;
        max-width: 800px;
        margin: 20px auto;
        position: relative;
    }

    .timeline {
        position: relative;
        height: 100px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .timeline-stage {
        text-align: center;
        flex: 1;
        position: relative;
        z-index: 2;
    }

    .progress-line {
        position: absolute;
        top: 50%;
        left: 0;
        height: 8px;
        width: 100%;
        background: white;
        z-index: 1;
        border-radius: 4px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #d91e18, #7ec8e3);
        transition: width linear;
    }

    .icon-mover {
        position: absolute;
        top: -30px;
        width: 60px;
        height: auto;
        transition: left linear;
        z-index: 3;
    }

    .tiempo-estimado {
        text-align: center;
        font-weight: bold;
        margin-top: 20px;
        font-size: 1.1rem;
    }

    .btn-inicio {
        position: absolute;
        top: 15px;
        left: 15px;
        background: linear-gradient(45deg, #d91e18, #7ec8e3);
        color: white;
        padding: 10px 20px;
        border-radius: 25px;
        border: none;
        font-weight: bold;
        cursor: pointer;
        text-decoration: none;
    }
</style>
</head>
<body>

<a href="index.html" class="btn-inicio">Inicio</a>

<h1>Seguimiento de Pedido</h1>

<div class="pedido-info" id="pedido-info">
    <!-- Aquí se mostrará el código o el formulario -->
</div>

<div class="timeline-container">
    <div class="timeline">
        <div class="progress-line">
            <div class="progress-fill" id="progress-fill"></div>
        </div>

        <div class="timeline-stage" data-icon="cliente.png">Verificación</div>
        <div class="timeline-stage" data-icon="chef.png">Preparación</div>
        <div class="timeline-stage" data-icon="empaque.png">Empaque</div>
        <div class="timeline-stage" data-icon="moto.png">Envío</div>
        <div class="timeline-stage" data-icon="entregado.png">Entregado</div>

        <img src="cliente.png" id="icon-mover" class="icon-mover" style="left:0%;" />
    </div>
</div>

<div class="tiempo-estimado" id="tiempo-estimado"></div>

<script>
    const pedidoInfo = document.getElementById("pedido-info");
    const codigoPedido = localStorage.getItem("codigoPedido") || "";
    const iconMover = document.getElementById("icon-mover");
    const progressFill = document.getElementById("progress-fill");
    const etapas = document.querySelectorAll(".timeline-stage");
    const tiempoEstimadoDiv = document.getElementById("tiempo-estimado");

    if (codigoPedido) {
        pedidoInfo.innerHTML = `<p class="codigo-pedido">Código de Pedido: ${codigoPedido}</p>`;
        iniciarAnimacion();
    } else {
        pedidoInfo.innerHTML = `
            <form class="rastreo-form" onsubmit="buscarPedido(event)">
                <label>Nombre del Cliente:</label>
                <input type="text" id="nombreCliente" required>
                <label>Código del Pedido:</label>
                <input type="text" id="codigoPedidoInput" required>
                <button type="submit">Rastrear</button>
            </form>
        `;
    }

    function buscarPedido(e) {
        e.preventDefault();
        const codigo = document.getElementById("codigoPedidoInput").value;
        localStorage.setItem("codigoPedido", codigo);
        location.reload();
    }

    function iniciarAnimacion() {
        let tiempos = [
            5, // Verificación -> Preparación
            25, // Preparación -> Empaque
            8, // Empaque -> Envío
            8  // Envío -> Entregado (cerca)
        ];

        const ciudad = localStorage.getItem("ciudadEntrega") || "";
        if (ciudad.toLowerCase() !== "chía" && ciudad.toLowerCase() !== "chia" && ciudad.toLowerCase() !== "cajicá" && ciudad.toLowerCase() !== "cajica") {
            tiempos[3] = 30; // Lejos
        }

        let totalTiempo = tiempos.reduce((a,b) => a + b, 0);
        let acumulado = 0;

        etapas.forEach((etapa, index) => {
            if (index < etapas.length - 1) {
                let duracion = tiempos[index] * 1000; // ms
                setTimeout(() => {
                    iconMover.src = etapa.dataset.icon;
                    let leftPos = (index / (etapas.length - 1)) * 100;
                    iconMover.style.left = leftPos + "%";
                    progressFill.style.width = leftPos + "%";
                }, acumulado);

                acumulado += duracion;
            }
        });

        // última etapa
        setTimeout(() => {
            iconMover.src = etapas[etapas.length - 1].dataset.icon;
            iconMover.style.left = "100%";
            progressFill.style.width = "100%";
        }, acumulado);

        // Tiempo estimado
        let minutos = totalTiempo / 1; // porque cada valor está en segundos simulados
        tiempoEstimadoDiv.textContent = `Tiempo estimado de entrega: ${minutos} minutos`;
    }
</script>

</body>
</html>
